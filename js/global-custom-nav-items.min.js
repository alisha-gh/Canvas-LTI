/**
// @name        CanvasLMS - Global Custom Navigation
// @namespace   https://github.com/robert-carroll/canvaslms-global-custom-navigation
// @description items only
//
**/

// handle css in this js file, or you can remove it if...
// you include the contents of /css/global-custom-nav-items.css in your Canvas Themes css file
!function(){if(0==document.querySelectorAll('[data-global-custom-nav-css="set"]').length){let e={"i.gcn_inst_menu_icon:before":"font-size: 1.625rem;","i.gcn_inst_rspv_icon":"color: var(--ic-brand-primary);"};if(void 0!==e&&Object.keys(e).length>0){let t=document.createElement("style");t.setAttribute("data-global-custom-nav-css","set"),document.head.appendChild(t);let n=t.sheet;Object.keys(e).forEach((function(t){n.insertRule(`${t} { ${e[t]} }`,n.cssRules.length)}))}}}();

(function () {
  'use strict';

  // minified line for global custom nav [items only]
  const globalCustomNav={cfg:{glbl:{nav_selector:"#menu",trayActiveClass:"ic-app-header__menu-list-item--active"},rspv:{tray_portal:`span[dir="${document.querySelector("html").getAttribute("dir")??"ltr"}"] div[role="dialog"] ul`,tray_container:'div[class$="-tray__content"]'},targets:["_self","_blank","_parent","_top"]},load:e=>{(document.querySelector(globalCustomNav.cfg.glbl.nav_selector)||document.querySelector(globalCustomNav.cfg.rspv.tray_portal))&&("undefined"!==document.querySelector(globalCustomNav.cfg.glbl.nav_selector)&&(globalCustomNav.dir=document.querySelector("html").getAttribute("dir")??"ltr",globalCustomNav.nav_items=Array.isArray(e.nav_items)?e.nav_items:e,globalCustomNav.prepare_nav_items(globalCustomNav.nav_items,!1)),globalCustomNav.watch_burger_tray())},watch_burger_tray:(e,t)=>{const o=document.querySelector(globalCustomNav.cfg.rspv.tray_portal),r=document.querySelector("div.rspv-global-custom-nav");if(o)null==o||null==document.querySelector(".mobile-header-hamburger").offsetParent||r||(t.disconnect(),globalCustomNav.prepare_nav_items(globalCustomNav.nav_items,!0),document.querySelector(globalCustomNav.cfg.rspv.tray_container).classList.add("rspv-global-custom-nav"),globalCustomNav.exit_burger_tray());else if(void 0===t){new MutationObserver(globalCustomNav.watch_burger_tray).observe(document.body,{childList:!0,subtree:!0})}},exit_burger_tray:(e,t)=>{const o=document.querySelector(globalCustomNav.cfg.rspv.tray_portal);if(o){if(void 0===t){new MutationObserver(globalCustomNav.exit_burger_tray).observe(document.body,{childList:!0,subtree:!0})}}else o||(t.disconnect(),globalCustomNav.watch_burger_tray())},prepare_nav_items:(e,t=!0)=>{e.forEach((e=>{(void 0===e.roles||e.roles())&&(globalCustomNav.create_nav_icon(e,t),globalCustomNav.append_item(e,t),e.tray&&globalCustomNav.tray(e,t))}))},create_nav_icon:(e,t=!0)=>{e.tidle=e.title.replace(/[\W_]+/g,"")||Math.random().toString(18).slice(2),e.slug=`global_nav_${e.tidle}_link`;const o=1==ENV.K5_USER&&1==t?"Home":"Dashboard",r=t?`${globalCustomNav.cfg.rspv.tray_portal} svg[name="Icon${o}"]`:`#global_nav_${o.toLowerCase()}_link`,a=document.querySelector(r).closest("li").cloneNode(!0);a.setAttribute("id",(t?"rspv-":"")+`${e.slug}-item`),a.querySelector("svg").parentElement.classList.add((t?"rspv-":"")+`svg-${e.tidle}-holder`);const l=(t?"rspv-":"")+e.slug;a.querySelector("a").setAttribute("id",l),a.querySelector("a").href=e.href,void 0!==e.target&&globalCustomNav.cfg.targets.includes(e.target)&&a.querySelector("a").setAttribute("target",e.target),(a.querySelector(".menu-item__text")||a.querySelector('span[letter-spacing="normal"]')).textContent=e.title;const s=a.querySelector((t?".rspv-svg":".svg")+`-${e.tidle}-holder`);a.querySelector("svg").classList.remove("ic-icon-svg--dashboard","svg-icon-home");let c=[...a.querySelector("svg").classList];if(t||a.classList.remove(globalCustomNav.cfg.glbl.trayActiveClass),a.querySelector("svg").remove(),1==/^icon-[a-z]/.test(e.icon_svg)){let o=`<div id="${(t?"rspv-":"")+`${e.slug}-svg`}" role="presentation">`;o+=`<i class="icon-line ${e.icon_svg}${t?" gcn_inst_rspv_icon":""} gcn_inst_menu_icon"></i></div>`,s.insertAdjacentHTML("afterbegin",o)}else/^https/.test(e.icon_svg)?fetch(e.icon_svg,{mode:"cors",method:"GET",headers:{"Access-Control-Request-Method":"GET",Accept:"text/plain","Content-Type":"text/plain"}}).then((e=>e.text())).then((o=>{s.insertAdjacentHTML("afterbegin",o),a.querySelector("svg").setAttribute("id",(t?"rspv-":"")+`${e.slug}-svg`),a.querySelector("svg").classList.add(...c)})).catch(console.error.bind(console)):/^<svg/.test(e.icon_svg)&&(s.insertAdjacentHTML("afterbegin",e.icon_svg),a.querySelector("svg").setAttribute("id",(t?"rspv-":"")+`${e.slug}-svg`),a.querySelector("svg").classList.add(...c));e.icon=a},append_item:(e,t=!0)=>{const o=t?globalCustomNav.cfg.rspv.tray_portal:globalCustomNav.cfg.glbl.nav_selector,r=document.querySelector(`${o} li:last-child`);if("undefined"!==e.position&&"number"==typeof e.position){const o=(1==t?globalCustomNav.cfg.rspv.tray_portal:globalCustomNav.cfg.glbl.nav_selector)+` > li:nth-of-type(${e.position})`;document.querySelector(o).after(e.icon)}else"undefined"!==e.position&&"after"==e.position?r.after(e.icon):r.before(e.icon);const a=new RegExp(`^${e.href}`);!t&&a.test(window.location.pathname)&&(globalCustomNav.cfg.context_item=e.slug)}};

  const globalCustomNav_items = [{
    id: 1,
    title: 'LTS',
    icon_svg: 'icon-pin',
    href: 'https://instructure.design/#icons-font',
    target: '_blank',
    position: 1, 
  },
  {
    id: 2,
    title: 'Hosted Icon',
    icon_svg: 'https://raw.githubusercontent.com/instructure/instructure-ui/master/packages/ui-icons/svg/Line/pin.svg',
    href: 'https://community.canvaslms.com/',
    target: '_blank',
  }
];

(async function() {
  try {
      let response = await fetch('https://raw.githubusercontent.com/alisha-gh/Canvas-LTI/main/js/global-custom-nav-items-data.js');
      if (response.ok) {
          let scriptContent = await response.text();
          let script = document.createElement('script');
          script.type = 'text/javascript';
          script.text = scriptContent;
          document.head.appendChild(script);
      }
  } catch (error) {
      console.error('Error loading script:', error);
  }
})();

// load custom nav options
 globalCustomNav.load(globalCustomNav_items);

})();
